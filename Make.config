# Make.config
#
# See the README file for copyright information and how to reach the author.
#
#

# user defined stuff

PREFIX        = /usr/local
BINDEST       = $(DESTDIR)$(PREFIX)/bin
_BINDEST      = $(PREFIX)/bin
CONFDEST      = $(DESTDIR)/etc/poold

PCHARTDEST    = $(DESTDIR)/var/lib/pChart2.0
_PCHARTDEST   = /var/lib/pChart2.0

SYSTEMDDEST   = $(DESTDIR)/etc/systemd/system

DEBUG = 1

# -----------------------
# don't touch below ;)

CPP        = g++
doCompile  = $(CPP) -c $(CFLAGS) $(DEFINES)
doLink     = $(CPP) $(LFLAGS)
doLib      = ar -rs

PLGSRCDIR  = ./PLUGINS
TMPDIR     = $(DESTDIR)/tmp

#USELIBXML = 1
#USECURL   = 1
#USEJPEG   = 1

USES = -DUSEUUID -DUSEMD5 -DUSELIBXML -DUSELIBARCHIVE -DUSEJSON -DUSEGUNZIP
DEFINES += -D_GNU_SOURCE -DTARGET='"$(TARGET)"' -DLOG_PREFIX='""' $(USES)
DEFINES += -DBIN_PATH='"$(_BINDEST)"'

ifdef USELIBXML
  DEFINES += $(shell xml2-config --cflags)
endif

ifdef DEBUG
  CFLAGS += -ggdb -O0
endif

#CFLAGS += -pthread -fPIC -std=c++11 -Wno-psabi -Wall -Wreturn-type -Wno-parentheses \
#          -Wformat -pedantic -Wunused-variable -Wunused-label \
#          -Wunused-value -Wunused-function -Wno-long-long \
#          -D_LARGEFILE_SOURCE -D_FILE_OFFSET_BITS=64

CFLAGS  += -pthread -fPIC -std=c++17 -Wno-psabi -Wall -Wreturn-type -Wformat -pedantic -Wunused-variable -Wunused-label \
           -Wunused-value -Wunused-function -Wno-long-long -Wno-unused-parameter \
           -D_LARGEFILE_SOURCE -D_FILE_OFFSET_BITS=64 -D_LARGEFILE64_SOURCE



%.o: %.c
	$(doCompile) -o $@ $<
